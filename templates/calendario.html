{% extends "MAESTRA.html" %}

{% block titulo %}
Calendario
{% endblock %}


{% block estilos %}

<style>
    :root {
        --width: 150px;
    }

    th , td {
        border: 1px solid #ffffffae;
        text-align: center;
        border-radius: 5px;
    }

    th {
        min-width: var(--width);
    }

    th:first-of-type {
        min-width: 100px;
    }
    
    thead th.head_col {
        background: var(--bg_table);
        position: sticky;
        top: var(--sizeT);
        z-index: 110;    
    }

    tbody td.head_row {
        position: sticky;
        left: var(--sizeT);
        background: var(--bg_table); 
        z-index: 109;     
        height: 100px;
    }

    thead th:first-child {
        position: sticky;
        top: var(--sizeT);
        left: var(--sizeT);
        z-index: 111; 
        background-color: rgb(37, 37, 37);
    }
    
    td {
        border: 1px solid var(--cc);
    }
    
    .activity_cell {
        --cc: #ffffff20;
    }

    .current_date {
        /* --cc: #ffffff6c; */
        --cc: color-mix(in srgb, #ffffff49 100%, var(--color3) 100%) ;
    }
    
    .tomorrow_date {
        --cc: #ffffff6b;
    }

    .current_datetime {
        animation: alert 0.5s infinite;
    }

    @keyframes alert {

        0%,
        100% {
            border: 1px solid var(--color2);
        }

        50% {
            border: 1px solid var(--color3);
        }
    }

</style>



<style>
    table {
        border-collapse: separate;
        border-spacing: 2px;
    }

    :root {
        --bg_table: #3b3b3b;
        --sizeT: 1px;
    }

    .container_calendar {
        padding: var(--sizeT);
    }
    

    .container_grid {
        grid-template-columns: 3fr 1fr;
    }

    .container_list {
        height: 85vh;
        overflow-x: auto;
        align-items: center;
    }

    .container_calendar {
        overflow: auto;
        position: relative;
        max-height: 85vh;
        background-color: rgba(0, 0, 0, 0.316);
        border-radius: 5px;
    }
    
    .actividad {
        --sizeIcon: 40px;
        --borderRadius: 10px;
        
        border-radius: var(--borderRadius);
        display: grid;
        grid-template-columns: var(--sizeIcon) auto 25px;
        align-items: center;
        padding: 5px;
        width: 95%;
    }

    .a_icon {
        border-radius: calc( var(--borderRadius) - 5px );
        display: flex;
        height: calc( var(--sizeIcon) - 5px );
        aspect-ratio: 1 / 1;
        justify-content: center;
        align-items: center;
    }

    .a_icon i {
        font-size: 130%;
    }

    .a_titulo {
        font-size: 90%;
        /* font-weight: bold; */
    }

    .a_end {
        display: flex;
        gap: 10px;
        font-size: 90%;
    }

    .a_fecha {
        color: grey;
    }

    .a_tipo {
        color: #cccccc;
    }

    .a_buttons {
        display: flex;
        flex-direction: column;
        gap: 5px;
        align-items: center;
    }

    .a_buttons .button {
        padding: 0;
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        aspect-ratio: 1 / 1;
        border-radius: 5px;
        border: 1px solid var(--cb);
        color: var(--cb);
        background-color: color-mix(in srgb, transparent 100%, var(--cb) 20%);
    }

    .a_buttons i {
        font-size: 80%;
    }

    .a_buttons .button.btn_consult {
        --cb: #1675db;
    }

    .a_buttons .button.btn_delete {
        --cb: #c11000;
    }

    .a_buttons .button.btn_update {
        --cb: #bebb00;
    }



    :root {
        --sizeItemIcon: 30px;
    }

    .list_items {
        display: flex;
        flex-direction: column;
        gap:     5px;
        padding: 5px;
    }

    .item {
        padding: 5px;
        border-radius: 5px;
        gap: 10px;
        font-size: 90%;
        display: flex;
        flex-direction: column;
    }

    .i_icon {
        grid-area: i_i;
        height: var(--sizeItemIcon);
        aspect-ratio: 1 / 1 ;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 5px;
    }
    
    .i_icon i {
        font-size: 120%;
    }

    .i_start {
        display: flex;
        gap: 5px;
    }

    .i_info {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .i_nombre {
        text-align: left;
    }

    .i_titulo {
        padding: 0;
        text-align: left;
    }

    .i_titulo {
        padding: 0;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        display: block;
        width: calc( var(--width) - var(--sizeItemIcon) - 35px ) ;
    }

    .i_tipo {
        color: #cecece;
        font-size: 90%;
        text-align: left;
    }

    .i_fecha {
        text-align: left;
        color: #b1b1b1;
        font-size: 85%;
    }
    
    .modal_dialog {
        width: 550px;
    }

    .modal_body {
        grid-template-columns: repeat( 2 , 1fr );
    }

</style>
{% endblock %}


{% block contenido %}

<div class="container_title">
    <p class="title">
        Calendario
    </p>
</div>
    
{% set local_date = local_datetime.strftime("%Y-%m-%d") %}
{% set local_hour = local_datetime.strftime("%H") | int %}
{% set local_minute = local_datetime.strftime("%M") | int %}

<div class="container_grid">
    <div class="container_calendar">
        <table>
            <thead>
                <th class="head_cell">
                    <div>
                        {{ local_datetime.strftime("%Y-%m-%d") }}
                    </div>
                    <div>
                        {{ local_datetime.strftime("%H : %M") }}
                    </div>
                </th>
                {% for col in columnas %}
                <th class="head_col">
                    <div>
                        <div>
                            {{ col.0 }}
                        </div>
                        <div>
                            {{ dias[col.1] }}
                        </div>
                    </div>
                </th>
                {% endfor %}
            </thead>
            <tbody>
                {% for fil in filas %}
                    <tr>
                        <td class="head_row" data-hora="{{fil.0}}">
                            {{ fil.0 }} : {{ fil.1 }}
                        </td>

                        {% for colu in columnas %}

                        {% set col_fecha = colu.0|add_days(1) if fil.0 + DIFH < local_hour else colu.0 %}
                        {% set col_dia   = colu.1 + 1         if fil.0 + DIFH < local_hour else colu.1 %}

                        <td class="activity_cell 
                        {{ 'current_datetime' if local_date == col_fecha and local_hour == fil.0 else '' }}
                        {{ 'current_date' if local_date == col_fecha else '' }}
                        {{ 'tomorrow_date' if local_date|add_days(1) == col_fecha else '' }}
                        " >
                            <div class="list_items" data-fecha="{{col_fecha}}" data-hora="{{fil.0}}">
                                <!-- {{ col_fecha }}
                                {{ fil.0 }} -->

                                {% for a in actividades  %}
                                    {% set a_date = a.fecha.strftime("%Y-%m-%d") %}
                                    {% set tomorrow = a_date|add_days(1) %}

                                    {% set a_hora = a.fecha.strftime("%H") | int %}
                                    {% set a_minuto = a.fecha.strftime("%M") %}

                                    {% if ( fil.0 == a_hora and a_date == col_fecha ) %}

                                    <style>
                                        .item[data-id="{{a.id}}"] {
                                            background-color: color-mix(in srgb, transparent 100%, {{a.color}} 20%) ;
                                            border: 1px solid {{a.color}} ;
                                        }

                                        .item[data-id="{{a.id}}"] .i_icon {
                                            background-color: {{ a.color }};
                                        }

                                        .item[data-id="{{a.id}}"] .i_titulo {
                                            color: color-mix(in srgb, white 25%, {{ a.color }} 100%) ;
                                        }
                                    </style>

                                    <div class="item" data-id="{{a.id}}">
                                        <div class="i_start">
                                            <div class="i_icon">
                                                {% if a.icono %}
                                                    <i class="{{a.icono}}"></i>
                                                {% else %}
                                                    {{ a.siglas }}
                                                {% endif %}
                                            </div>

                                            <div class="i_info">
                                                <div class="i_titulo">
                                                    {{ a.titulo }}
                                                </div>

                                                <div class="i_tipo">
                                                    {{ a.tipo }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="i_nombre">
                                            {{ a.nombre }}
                                        </div>
                                        
                                        <div class="i_fecha">
                                            {{ a.fecha }}
                                        </div>

                                    </div>



                                    {% endif %}
                                {% endfor %}
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="container_list">
        <div class="clickable-modal button btn_insert" data-target="insert_actividad">
            <i class="fa-solid fa-plus"></i>
            Agregar actividad
        </div>

        {% for a in actividades %}
        <style>
            .actividad[data-id="{{a.id}}"] {
                background-color: color-mix(in srgb, transparent 100%, {{a.color}} 10%);
                border: 1px solid {{ a.color }};
            }

            .actividad[data-id="{{a.id}}"] .a_icon {
                background-color: {{a.color}} ;
            }
            
            .actividad[data-id="{{a.id}}"] .a_titulo {
                color: color-mix(in srgb, {{a.color}} 100%, white 50%) ;
            }

        </style>

        <div class="actividad" data-id="{{a.id}}">
            <div class="a_icon">
                {% if a.icono %}
                    <i class="{{a.icono}}"></i>
                {% else %}
                    {{ a.siglas }}
                {% endif %}
            </div>
            
            <div class="a_info">
                <div class="a_titulo">
                    {{ a.titulo }}
                </div>

                <div class="a_nombre">
                    {{ a.nombre }}
                </div>

                <div class="a_end">
                    <div class="a_fecha">
                        {{ a.fecha }}
                    </div>
                    |
                    <div class="a_tipo">
                        {{ a.tipo }}
                    </div>
                </div>
            </div>

            <div class="a_buttons">
                <div class="button btn_consult">
                    <i class="fa-solid fa-eye"></i>
                </div>
                <div class="button btn_update">
                    <i class="fa-solid fa-pencil"></i>
                </div>
                <div class="button btn_delete">
                    <i class="fa-solid fa-trash"></i>
                </div>
            </div>
        </div>


        {% endfor %}
    </div>
</div>


<div class="modal_space" id="insert_actividad">
    <form class="modal_dialog modal_form" action=" {{ url_for('guardar_actividad') }} " method="post">
        <div class="modal_header">
            Agregar actividad
        </div>
        <div class="modal_body">

            <div class="form_field">
                <label for="">Nombre</label>
                <input type="text" name="nombre" id="" required>
            </div>

            <div class="form_field">
                <label for="">Fecha</label>
                <input type="datetime-local" name="fecha" id="" >
            </div>
            
            <div class="form_field">
                <label for="">Tipos</label>
                <select name="tipo_actividadid" id="">
                    <option value=""> Sin tipo </option>
                    {% for t in tipo_actividades %}
                    <option value="{{t.id}}">{{ t.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form_field">
                <label for="">Contextos</label>
                <select name="contextoid" id="" >
                    <option value="" selected disabled> Sin contexto </option>
                    {% for c in contextos %}
                    <option value="{{c.id}}">{{c.siglas}} - {{c.nombre}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form_field">
                <label for="">Grupos</label>
                <select name="grupoid" id="">
                    <option value="" selected disabled> Sin grupo </option>
                    {% for g in grupos %}
                    <option value="{{g.id}}"> {{ g.cu_siglas }} - {{ g.cu_nombre }} - {{ g.gr_nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form_field">
                <label for="">Descripcion</label>
                <textarea name="descripcion" id=""></textarea>
            </div>

            <div class="form_field">
                <label for="">Siglas</label>
                <input type="text" name="siglas" id=""  minlength="1" maxlength="5" style="width: 60px;" >
            </div>

            <div class="form_field">
                <label for="">Icono</label>
                <input type="text" name="icono" id="" >
            </div>

            <div class="form_field">
                <label for="">Color</label>
                <input type="color" name="color" id="" >
            </div>

        </div>

        <div class="modal_footer">
            <button class="button close_modal" type="reset">
                Cerrar
            </button>
            <button class="button submit_modal" type="submit">
                Guardar
            </button>
        </div>
    </form>
</div>




{% endblock %}



{% block scripts %}
<script>

    pintarElemento(' .a_icon ');
    pintarElemento(' .i_icon ');

</script>
{% endblock %}